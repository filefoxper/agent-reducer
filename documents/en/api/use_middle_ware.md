# useMiddleWare( agent, ...mdws )

This function can copy an `Agent` object, and add some different `MiddleWares` on the copy object. So, if you want to use different `MiddleWares` in some special situation on `Agent` method which has its own `MiddleWare`, you can use this api to make a copy `Agent` with different `MiddleWares`. 

The state of copy one keeps equal with the state of `Agent` object you passed in. We suggest you using the state of `Agent` object you passed in.

```typescript
function useMiddleWare<S, T extends OriginAgent<S>>(
  agent: T & { [agentDependenciesKey]?: AgentDependencies<S, T> },
  ...mdws: (MiddleWare | LifecycleMiddleWare)[]
): T
```
* agent - `Agent` object which is in a `AgentReducer` function created by [createAgentReducer](https://github.com/filefoxper/agent-reducer/blob/master/documents/en/api/create_agent_reducer.md).
* mdws - `MiddleWares` you want to use in this copy `Agent` object.

take a look at [example](https://github.com/filefoxper/agent-reducer/blob/master/test/en/api/useMiddleWare.spec.ts)
```typescript
import {
    createAgentReducer,
    MiddleWarePresets,
    MiddleWares,
    OriginAgent,
    useMiddleWare
} from "agent-reducer";

describe('how to use api useMiddleWare', () => {

    class VersionModel implements OriginAgent<number> {

        state = 0;

        async fetchVersion(version: number, delay: number) {
            await new Promise((r) => setTimeout(r, delay));
            return version;
        }

    }

    it("MiddleWares added by api useMiddleWare will override MiddleWares added by api createAgentReducer on the copy 'Agent'" +
        " which is generated by useMiddleWare", async () => {
        const {agent} = createAgentReducer(VersionModel, MiddleWares.takePromiseResolve());
        // MiddleWarePresets.takeLatest override MiddleWares.takePromiseResolve
        const copy = useMiddleWare(agent, MiddleWarePresets.takeLatest());
        const promise1 = copy.fetchVersion(1, 200);
        const promise2 = copy.fetchVersion(2, 0);
        await Promise.all([promise1, promise2]);
        // MiddleWarePresets.takeLatest override MiddleWares.takePromiseResolve,
        // and the first calling of fetchVersion returns can not be next state.
        // The agent.state keeps equal with the copy.state
        expect(agent.state).toBe(2);
        expect(copy.state).toBe(agent.state);
    });

});
```

Go back to [API Reference](https://github.com/filefoxper/agent-reducer/blob/master/documents/en/api/index.md)