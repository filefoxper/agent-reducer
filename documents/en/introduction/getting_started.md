# Getting started

## Installation

The `agent-reducer` package lives in [npm](https://www.npmjs.com/get-npm). To install the latest stable version, run the following command:
```
npm i agent-reducer
```

If you just want to use it with other tools, such as `react` or `redux`, we recommend:

1. [use-agent-reducer](https://www.npmjs.com/package/use-agent-reducer) react hook for replacing `react useReducer`.
2. [use-redux-agent](https://www.npmjs.com/package/use-redux-agent) react hook for replacing `react-redux`.

Install [use-agent-reducer](https://www.npmjs.com/package/use-agent-reducer):
```
npm i use-agent-reducer
```

Install [use-redux-agent](https://www.npmjs.com/package/use-redux-agent):
```
npm i use-redux-agent
```

## OriginAgent

OriginAgent is a basic model for generating `reducer function` and `agent` instance. It can be an object or a class.

object model:
```typescript
import {OriginAgent} from 'agent-reducer';

interface State{
    name?:string,
}

interface Model extends OriginAgent<State>{
    state:State
}

const model:Model={

    state:{}, // the data you want to persist

    // the method to generate a next state
    setName( primaryName:string, secondaryName:string ):State {
        const name = `${primaryName}.${secondaryName}`;
        return { ...this.state, name };
    }

}

const agentReducer = createAgentReducer(model);
```
class model:
```typescript
import {OriginAgent} from 'agent-reducer';

interface State{
    name?:string,
}

class Model implements OriginAgent<State>{

    state:State; // the data you want to persist

    constructor(){
        this.state = {};
    }

    // the method to generate a next state
    setName( primaryName:string, secondaryName:string ):State {
        const name = `${primaryName}.${secondaryName}`;
        return { ...this.state, name };
    }

}

const agentReducer = createAgentReducer(new Model());
```
We recommend using class model.

## AgentReducer

`AgentReducer` is a reducer function generated by API createAgentReducer.  `AgentReducer` has some useful properties, and the most important property `agent` is widely used in `agent-reducer` system. It is a proxy object for your `OriginAgent model`, and only call the methods from `agent` directly can change state.

create an `AgentReducer`:
``` typescript
import {OriginAgent,createAgentReducer} from 'agent-reducer';

interface State{
    name?:string,
}

class Model implements OriginAgent<State>{

    state:State;

    constructor(){
        this.state = {}; // the data you want to persist
    }

    // the method to generate a next state
    setName( primaryName:string, secondaryName:string ):State {
        const name = `${primaryName}.${secondaryName}`;
        return { ...this.state, name };
    }

}
// generate a 'AgentReducer' function
const agentReducer = createAgentReducer(Model);

// pick the agent from 'AgentReducer' function.
const { agent } = agentReducer;

// call agent method, and change the next state
agent.setName('primary','secondary'); 

const name = agent.state.name; // 'primary.secondary'
```

## MiddleWare

MiddleWare system makes `agent` more flexible. You can use MiddleWare to reproduce the `next state` when it is returned by a agent method, or control `agent` lifecycle (disable an `agent` changing state action).

promise MiddleWare:
``` typescript
import {OriginAgent,createAgentReducer,MiddleWarePresets} from 'agent-reducer';

interface State{
    name?:string,
}

class Model implements OriginAgent<State>{

    state:State;

    constructor(){
        this.state = {}; // the data you want to persist
    }
    // This is an async method, it returns a promise object,
    // if you do nothing to reproduce the next state,
    // the next state will be a promise.
    async fetchName():Promise<State> {
        const name = await Promise.resolve('primary.secondary');
        return { ...this.state, name };
    }

}

// add MiddleWarePresets.takePromiseResolve(), 
// the next state will be reproduced, if it is a promise, 
// and the promise resolved data will finally be a next state.
const agentReducer = createAgentReducer(Model,MiddleWarePresets.takePromiseResolve());

// take the agent from 'AgentReducer' function.
const { agent } = agentReducer;

// call agent method, and change the next state
await agent.fetchName(); 

const name = agent.state.name; // 'primary.secondary'
```
If you are using `Babel decorator plugin`, you can use `MiddleWarePresets.takePromiseResolve()` more simple.
``` typescript
import {OriginAgent,createAgentReducer,middleWare,MiddleWarePresets} from 'agent-reducer';

interface State{
    name?:string,
}

class Model implements OriginAgent<State>{

    state:State;

    constructor(){
        this.state = {}; // the data you want to persist
    }
    // This is an async method, it returns a promise object,
    // if you do nothing to reproduce the next state,
    // the next state will be a promise.
    // add MiddleWarePresets.takePromiseResolve(), 
    // the next state will be reproduced, if it is a promise, 
    // and the promise resolved data will finally be a next state.
    @middleWare(MiddleWarePresets.takePromiseResolve())
    async fetchName():Promise<State> {
        const name = await Promise.resolve('primary.secondary');
        return { ...this.state, name };
    }

}


const agentReducer = createAgentReducer(Model);

// take the agent from 'AgentReducer' function.
const { agent } = agentReducer;

// call agent method, and change the next state
await agent.fetchName(); 

const name = agent.state.name; // 'primary.secondary'
```
If you want to process a promise resolved data and merge it with `this.state`, you can use `MiddleWarePresets.takePromiseResolveAssignable`.
``` typescript
import {OriginAgent,createAgentReducer,middleWare,MiddleWarePresets} from 'agent-reducer';

interface State{
    id:number,
    name?:string,
}

class Model implements OriginAgent<State>{

    state:State;

    constructor(){
        this.state = {id:0}; // the data you want to persist
    }
    // MiddleWarePresets.takePromiseResolveAssignable 
    // will resolve the promise problem first,
    // then assign result with this.state to be a new state
    @middleWare(MiddleWarePresets.takePromiseResolveAssignable())
    async fetchName():Promise<State> {
        const name = await Promise.resolve('primary.secondary');
        return { name };
    }

}

const agentReducer = createAgentReducer(Model);

// take the agent from 'AgentReducer' function.
const { agent } = agentReducer;

// call agent method, and change the next state
await agent.fetchName(); 

const name = agent.state.name; // 'primary.secondary'
```
One MiddleWare represent one feature, and chain together, their features will be token one by one, such as `MiddleWarePresets.takePromiseResolveAssignable()`, it is chained by `MiddleWares.takePromiseResolve()`,`MiddleWares.takeAssignable()`. We will learn how to chain them together and how to write a `MiddleWare` later.

[next to tutorial](https://github.com/filefoxper/agent-reducer/blob/master/documents/en/tutorial/intro.md)